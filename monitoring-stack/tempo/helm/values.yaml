---
# Grafana Tempo Helm Values
# Tempo is a high-volume distributed tracing backend

# Deployment mode: SingleBinary or Distributed
tempo:
  # Storage configuration
  storage:
    trace:
      backend: local  # local, s3, gcs, azure
      local:
        path: /var/tempo/traces
      # For production, use object storage
      # backend: s3
      # s3:
      #   bucket: tempo-traces
      #   endpoint: s3.amazonaws.com
      #   access_key: ${S3_ACCESS_KEY_ID}
      #   secret_key: ${S3_SECRET_ACCESS_KEY}

  # Retention configuration
  retention:
    enabled: true
    max_age: 720h  # 30 days

  # Ingestion limits
  ingestion:
    max_spans_per_trace: 100000
    max_traces_per_user: 10000
    rate_limit_bytes: 5000000  # 5MB/s
    burst_size_bytes: 15000000  # 15MB

  # Query limits
  query:
    max_duration: 0  # No limit
    max_search_duration: 168h  # 7 days

  # Metrics generator (creates metrics from traces)
  metricsGenerator:
    enabled: true
    remoteWriteUrl: http://prometheus-k8s.monitoring.svc.cluster.local:9090/api/v1/write
    processors:
      - service-graphs
      - span-metrics
    registry:
      collection_interval: 15s

  # Receivers (how traces are ingested)
  receivers:
    jaeger:
      protocols:
        grpc:
          endpoint: 0.0.0.0:14250
        thrift_http:
          endpoint: 0.0.0.0:14268
        thrift_compact:
          endpoint: 0.0.0.0:6831
        thrift_binary:
          endpoint: 0.0.0.0:6832
    zipkin:
      endpoint: 0.0.0.0:9411
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318

  # Multitenancy (disable for single-tenant)
  multitenancy:
    enabled: false

# Distributed mode components
distributor:
  replicas: 2
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

ingester:
  replicas: 2
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""  # Use default
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

compactor:
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

querier:
  replicas: 2
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

queryFrontend:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

metricsGenerator:
  enabled: true
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Gateway (nginx)
gateway:
  enabled: true
  replicas: 1
  ingress:
    enabled: false
    # ingressClassName: traefik
    # hosts:
    #   - host: tempo.techcasa.io
    #     paths:
    #       - path: /
    #         pathType: Prefix
    # tls:
    #   - secretName: tempo-tls
    #     hosts:
    #       - tempo.techcasa.io

# Monitoring
serviceMonitor:
  enabled: true
  interval: 30s
  labels:
    prometheus: k8s

# Service
service:
  type: ClusterIP

# Test
test:
  enabled: false
