---
# Grafana Loki Helm Values
# Loki is a horizontally-scalable, highly-available log aggregation system

# Deployment mode: SingleBinary, SimpleScalable, or Distributed
deploymentMode: SimpleScalable

loki:
  # Loki configuration
  auth_enabled: false

  # Storage configuration
  commonConfig:
    replication_factor: 2
    path_prefix: /var/loki

  storage:
    type: filesystem
    # For production, use object storage (S3, GCS, Azure, etc.)
    # type: s3
    # bucketNames:
    #   chunks: loki-chunks
    #   ruler: loki-ruler
    #   admin: loki-admin
    # s3:
    #   endpoint: s3.amazonaws.com
    #   region: us-east-1
    #   secretAccessKey: ${S3_SECRET_ACCESS_KEY}
    #   accessKeyId: ${S3_ACCESS_KEY_ID}

  # Limits configuration
  limits_config:
    retention_period: 744h  # 31 days
    enforce_metric_name: false
    reject_old_samples: true
    reject_old_samples_max_age: 168h
    max_cache_freshness_per_query: 10m
    split_queries_by_interval: 15m
    # Ingestion limits
    ingestion_rate_mb: 10
    ingestion_burst_size_mb: 20
    per_stream_rate_limit: 5MB
    per_stream_rate_limit_burst: 15MB
    max_entries_limit_per_query: 5000
    max_query_series: 500
    max_query_lookback: 720h

  # Schema configuration
  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h

  # Ruler configuration (for alerts)
  rulerConfig:
    storage:
      type: local
      local:
        directory: /var/loki/rules
    rule_path: /tmp/scratch
    alertmanager_url: http://alertmanager-operated.monitoring.svc.cluster.local:9093
    ring:
      kvstore:
        store: inmemory
    enable_api: true

# Component-specific configurations
backend:
  replicas: 2
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""  # Use default StorageClass
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

read:
  replicas: 2
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

write:
  replicas: 2
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

# Gateway (nginx) configuration
gateway:
  enabled: true
  replicas: 1
  service:
    type: ClusterIP
    port: 80
  ingress:
    enabled: false
    # ingressClassName: traefik
    # hosts:
    #   - host: loki.techcasa.io
    #     paths:
    #       - path: /
    #         pathType: Prefix
    # tls:
    #   - secretName: loki-tls
    #     hosts:
    #       - loki.techcasa.io

# Monitoring
monitoring:
  # ServiceMonitor for Prometheus
  serviceMonitor:
    enabled: true
    interval: 30s
    labels:
      prometheus: k8s

  # Self-monitoring
  selfMonitoring:
    enabled: true
    grafanaAgent:
      installOperator: false
    lokiCanary:
      enabled: true

# Test pod
test:
  enabled: false

# Chart metadata
singleBinary:
  replicas: 0  # Disabled for SimpleScalable mode
