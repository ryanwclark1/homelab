#!/usr/bin/env bash
# Cluster health check script
# Generated by Ansible

set -e

echo "=== Cluster Health Check $(date) ==="

# Check Proxmox version
echo "Proxmox version:"
pveversion

# Check cluster status
echo ""
echo "Cluster status:"
pvecm status || echo "Not in cluster mode"

# Check services
echo ""
echo "Service status:"
for service in pve-cluster pvedaemon pveproxy pvestatd corosync; do
    systemctl is-active $service && echo "$service: OK" || echo "$service: FAILED"
done

# Check storage
echo ""
echo "Storage status:"
pvesm status

# Check system resources
echo ""
echo "System load:"
uptime

echo ""
echo "Memory usage:"
free -h

echo ""
echo "Disk usage:"
df -h | grep -E '(Filesystem|tank|/dev/)'

echo "=== Health Check Complete ==="
